(function(e,t){typeof define=="function"&&define.amd?define([],t):e.trackYouTubeVideos=t()})(this,function(){function r(){var e=document.createElement("script");e.src="http://www.youtube.com/player_api";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}var e,t=function(e){var t=this;e=e||{};this.iframeIds=e.ids||this._getYoutubePlayers();if(!this.iframeIds||this.iframeIds===[]){console.warn("No YouTube player detected, please check the documentation at https://github.com/obsidianart/youtube-statistics");return}this.storage=e.storage;window.onYouTubePlayerAPIReady=function(){var e,n;t.players=[];for(n=0;n<t.iframeIds.length;n++){e=new YT.Player(t.iframeIds[n],{events:{onStateChange:function(){return function(){t._userActed.apply(t,Array.prototype.slice.call(arguments))}}()}});t.players.push(e)}}};t.prototype={_userActed:function(e){var t={};if(e.data===YT.PlayerState.PLAYING)t.userAction="play";else{if(e.data!==YT.PlayerState.PAUSED)return!1;t.userAction="paused"}t.timecode=e.target.getCurrentTime();t.videoId=e.target.getVideoData().video_id;this.storage.save(t)},_getYoutubePlayers:function(){var e=document.getElementsByTagName("iframe"),t=[],n;if(!e.length)return null;for(var r=0;r<e.length;r++)if(/^https?:\/\/(?:www\.)?youtube(?:-nocookie)?\.com(\/|$)/i.test(e[r].src))if(e[r].id)t.push(e[r].id);else{n="YT-"+parseInt(Math.random()*1e5);e[r].id=n;t.push(n)}return t}};var n=function(e){this.url=e.url;this.userId=e.userId};n.prototype={save:function(e){console.group("User "+e.userAction);console.log("User id : "+this.userId);console.log("video id : "+e.videoId);console.log("timecode :"+e.timecode);console.groupEnd()}};return function(i,s){s=s||{};r();e=new t({storage:new n({url:s.url||"http://www.myserver.com",userId:i||"anonymous"})})}});